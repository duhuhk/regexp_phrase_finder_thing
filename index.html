<!DOCTYPE html>
<html>
<head>
<title>RegEx finder thingy</title>
<style>
	.highlight{
		background-color: yellow;
	}
</style>
</head>
<body>
<span>
	<b>Input text here: </b><br />
	<input type="text" id="plaintext-input" style="width: 95%; height: auto;">
</span>
<br /><br />
<span>
	<b>Key terms here: </b> (separate phrases with a '|', with no spaces on either side of the '|')<br />
	<input type="text" id="keywords" style="width: 95%; height: auto;">
</span>

<br /><br />
<input id="auto-exec" type="checkbox" checked> <label for="auto-exec">Automatically check for matches</label>
<br />
<button id="man-exec">Execute</button>
<hr /><br />

<h4 id="matchcount"></h4>
<br />
<p id="out"></p>

<br /><br /><hr /><br />

<p id="out2"></p>

<script>
	const iput = document.getElementById('plaintext-input');
	const ftag = document.getElementById('keywords');
	const auto = document.getElementById('auto-exec');
	const manu = document.getElementById('man-exec');
	const matchCount = document.getElementById('matchcount');
	const oput = document.getElementById('out');
	const Oput = document.getElementById('out2');
	
	ftag.value = 'example keyphrase 1|example keyphrase 2|example keyphrase 3';
	var FINDTAGS = ftag.value;
	
	const reg0 = /(?<=\.|\!|\?)\s(?<statement>[^\.\?\!]*omen[^\.\?\!]*(?<find>depend|progress|right)[^\.\?\!]*)/mig;
	const reg1 = /(?<=\.|\!|\?)\s(?<statement>[^\.\?\!]*(?<find>depend|progress|rights|right to|power)[^\.\?\!]*)/mig;
	var reg2 = new RegExp("(?<=\\.|\\!|\\?)\\s(?<statement>[^\\.\\?\\!]*(?<find>" + FINDTAGS + ")[^\\.\\?\\!]*)", 'mig');
	
	function checkerFn(reg, text){
		oput.innerHTML = '';
		Oput.innerHTML = text;
		
		let i = 0;
		while ( (match = reg.exec(text)) !== null) {
			i++;
			let head = document.createElement('h5');
			head.appendChild(document.createTextNode('Match ' + i + ' (from ' + match.index + ' to ' + reg.lastIndex + '):'));
			oput.appendChild(head);
			// oput.appendChild(document.createElement('br'));
			oput.appendChild(document.createTextNode(match[0]));
			oput.appendChild(document.createElement('br'));
			oput.appendChild(document.createElement('br'));
			
			Oput.innerHTML = Oput.innerHTML.split(match[0]).join('<span class=\"highlight">' + match[0] + '</span>');
			// console.log(`Found ${match[0]} start=${match.index} end=${reg.lastIndex}.`,);
		}
		
		matchCount.innerHTML = 'Matches: ' + i;
	}
	function exportMatches(a, t){
		oput.innerHTML = '';
		for(let i = 0; i < a.length; i++){
			let head = document.createElement('h5');
			head.appendChild(document.createTextNode('Match ' + i + ' (at ' + t.indexOf(a[i]) + '):'));
			oput.appendChild(head);
			// oput.appendChild(document.createElement('br'));
			oput.appendChild(document.createTextNode(a[i]));
			oput.appendChild(document.createElement('br'));
			oput.appendChild(document.createElement('br'));
		}
	}
	
	function update(){
		reg2 = new RegExp("(?<=\\.|\\!|\\?)\\s(?<statement>[^\\.\\?\\!]*(?<find>" + FINDTAGS + ")[^\\.\\?\\!]*)", 'mig');
		
		let text = iput.value;
		FINDTAGS = ftag.value;
		
		// oput.innerHTML = '';
		// Oput.innerHTML = text;
		
		if(auto.checked){	checkerFn(reg2, text);	}
		window.requestAnimationFrame(update);
	}
	window.requestAnimationFrame(update);
	
	manu.onclick = e => checkerFn(reg2, iput.value);
</script>
</body>
</html>
